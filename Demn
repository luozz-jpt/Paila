-- Paila Hub v4 - Abyss [BETA] RAYFIELD FIX + KAVO FALLBACK by Paila (pro Yoto)
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet('https://raw.githubusercontent.com/SiriusSoftwareLtd/Rayfield/main/source.lua'))()
end)

local Window
if success and Rayfield then
    Window = Rayfield:CreateWindow({
        Name = "Paila Hub v4 - Abyss (Rayfield Fix)",
        LoadingTitle = "Carregando pro Yoto...",
        LoadingSubtitle = "Full OP + Save Config",
        ConfigurationSaving = {Enabled = true, FolderName = "PailaAbyssV4", FileName = "YotoConfig"},
        Discord = {Enabled = false},
        KeySystem = false
    })
    print("Rayfield carregado suave!")
else
    print("Rayfield falhou, carregando Kavo fallback...")
    local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
    Window = Library.CreateLib("Paila Hub v4 - Abyss (Kavo Fallback)", "Midnight")
end

local player = game.Players.LocalPlayer
local rs = game:GetService("ReplicatedStorage")
local rsEvents = rs:WaitForChild("Remotes", 5) or rs:FindFirstChild("Events", 5) or rs
local tween = game:GetService("TweenService")

-- Mesmas funÃ§Ãµes OP do v3 (infiniteOxygen, autoCatchLoop, etc - copiei otimizadas)
local loops = {}
local function infiniteOxygen() 
    local stats = player:FindFirstChild("leaderstats")
    if stats then local oxy = stats:FindFirstChild("Oxygen") or player:FindFirstChild("Oxygen"); if oxy then oxy.Value = math.huge end end 
end

local function autoCatchLoop()
    if player.Character and player.Character:FindFirstChildWhichIsA("Tool") then
        pcall(function()
            rsEvents.CastHarpoon:FireServer()
            task.wait(0.1)
            rsEvents.CatchFish:FireServer()
            rsEvents.ReelFish:FireServer()
        end)
    end
end

local function fishESP()
    for _, obj in pairs(workspace:GetDescendants()) do
        if (obj.Name:lower():find("fish") or obj.Name:lower():find("mutant") or obj.Name:lower():find("legend")) and obj:IsA("Model") and not obj:FindFirstChild("PailaESP") then
            local hl = Instance.new("Highlight", obj); hl.Name = "PailaESP"; hl.FillTransparency = 0.3; hl.OutlineTransparency = 0
            if obj.Name:lower():find("mutant") then hl.FillColor = Color3.fromRGB(255,0,0)
            elseif obj.Name:lower():find("legend") then hl.FillColor = Color3.fromRGB(255,215,0)
            else hl.FillColor = Color3.fromRGB(0,255,0) end
            hl.OutlineColor = Color3.fromRGB(255,255,255)
        end
    end
end

local function autoSellReturn()
    local stats = player:FindFirstChild("leaderstats")
    if stats then
        local weight = stats:FindFirstChild("Weight")
        local oxy = stats:FindFirstChild("Oxygen")
        if weight and weight.Value >= (Rayfield and Rayfield.Flags.WeightLimit or 95) then
            rsEvents.SellFish:FireServer()
            if Rayfield then Rayfield:Notify({Title = "Paila", Content = "Vendeu " .. weight.Value .. "kg!", Duration = 3}) end
        end
        if oxy and oxy.Value <= 20 then
            local surface = workspace:FindFirstChild("Surface") or CFrame.new(0,100,0)
            tween:Create(player.Character.HumanoidRootPart, TweenInfo.new(1.5), {CFrame = surface}):Play()
            task.wait(2); pcall(function() rsEvents.ReturnToSurface:FireServer() end)
        end
    end
end

local function fastTube(speed) 
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        player.Character.Humanoid.WalkSpeed = speed; player.Character.Humanoid.JumpPower = speed * 2
    end 
end

local function equipHarpoon()
    for _, tool in pairs(player.Backpack:GetChildren()) do
        if tool:IsA("Tool") and tool.Name:lower():find("harpoon") then player.Character.Humanoid:EquipTool(tool); break end
    end
end

local function removeFog()
    if workspace.Terrain then workspace.Terrain.FogEnd = 100000; workspace.Terrain.FogStart = 100000 end
    game.Lighting.FogEnd = 100000; game.Lighting.FogStart = 100000
end

-- UI Elements (compatÃ­vel Rayfield OU Kavo)
local FarmTab
if Rayfield then
    FarmTab = Window:CreateTab("ðŸ¤¿ Farm Principal", 4483362458)
    FarmTab:CreateSection("Auto Features")
    
    FarmTab:CreateToggle({Name = "Auto Farm", CurrentValue = false, Flag = "AutoFarm", Callback = function(v)
        if v then loops.AutoFarm = task.spawn(function() while Rayfield.Flags.AutoFarm do autoCatchLoop(); task.wait(0.12) end end)
        else if loops.AutoFarm then task.cancel(loops.AutoFarm) end end
    end})
    
    FarmTab:CreateToggle({Name = "Inf Oxygen", CurrentValue = false, Flag = "InfO2", Callback = function(v)
        if v then loops.InfO2 = task.spawn(function() while Rayfield.Flags.InfO2 do infiniteOxygen(); task.wait(0.2) end end) end
    end})
    
    -- + outros toggles/sliders igual v3...
else  -- Kavo fallback
    local FarmSec = FarmTab:NewSection("Auto Features")
    FarmTab:NewToggle("Auto Farm", "Catch + Reel", function(state)
        spawn(function() while state do autoCatchLoop(); wait(0.12) end end)
    end)
    -- + toggles Kavo style...
end

-- Global loop (roda sempre)
task.spawn(function()
    while task.wait(1) do
        infiniteOxygen(); fishESP(); equipHarpoon(); removeFog()
        fastTube((Rayfield and Rayfield.Flags.TubeSpeed) or 50)
        autoSellReturn()
    end
end)

if Rayfield then Rayfield:Notify({Title = "Paila v4", Content = "Rayfield fixado pro Yoto! ðŸ˜ˆ", Duration = 5})
else print("Kavo UI aberta! Toggles no RightShift.") end

print("Paila v4 rodando full pro Abyss! UI sempre abre agora.")
